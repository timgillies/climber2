<script type="text/javascript" charset="utf-8">
  $(function() {
    new Highcharts.Chart({
      exporting: {
          sourceWidth: 800,
          sourceHeight: 400,

          // scale: 2 (default),
          enabled: true,
          filename: "routes__<%= @facility.name.downcase %>_<%= fz.name.downcase %>",

          buttons: {
                contextButton: {
                    symbolStroke: '#d5d5d5',
                    menuItems: [{
                        text: 'Export to PNG',
                        onclick: function () {
                            this.exportChart({
                                width: 3200
                            });
                        }
                    },{
                        text: 'Export to PDF',
                        onclick: function () {
                            this.exportChart({
                              type: 'application/pdf'
                            });
                        },
                        separator: false
                    },
                  ]
                }
            },
            chartOptions: {
                title: {
                    text: "<%= @facility.name.gsub(/[^0-9a-z ]/i, '') + " " + @facility.location.gsub(/[^0-9a-z ]/i, '') %>",
                    style: {
                        color: 'black',
                        fontWeight: 'bold',
                        fontFamily: "'Helvetica', sans-serif"
                    }
                },
                subtitle: {
                    text:  "<%= fz.name %>"
                },
            }

      },
      navigation: {
          buttonOptions: {
              align: 'right',
              verticalAlign: 'bottom',
              y: 32,
              theme: {
                r: '0',
                  states: {
                      hover: {
                          fill: '#a9a9a9',
                          stroke: '#a9a9a9',
                      },
                      select: {
                          fill: '#a9a9a9',
                          stroke: '#a9a9a9',
                      }
                  }
              }
          }
      },
      chart: {
        renderTo: "wall_dist-<%= fz.id %>",
        height: 50 * <%= raw @facility.walls.where("zone_id = ?", fz).count %>,
        spacingBottom: 35,
        type: "bar",
        style: {
          fontFamily: 'Helvetica',
        },
      },
      title: {
        text: ""
      },
      xAxis: {
        type: 'category',
        labels: {
          enabled: true,
        },
        tickLength: 0,
        minorGridLineWidth: 0,
        minorTickLength: 0,
      },
      yAxis: {
        title: {
          text: ""
        },
        labels: {
          enabled: false,
        },
        tickLength: 0,
        lineWidth: 0,
        minorGridLineWidth: 0,
        gridLineColor: 'transparent',
        minorTickLength: 0,
        lineColor: 'transparent',
        allowDecimals: false
      },
      credits: {
        enabled: true,
        text: '<%= @facility.name.gsub(/[^0-9a-z ]/i, '')%>  |  climbconnect.com',
        style: {
          fontSize: "12px",
        },
        href: false,
        position: {
          align: "right",
          verticalAlign: "bottom",
          x: -40,
          y: -8,
        }
      },
      legend: {
        enabled: false
      },
      plotOptions: {
        series: {
          pointWidth: 20,
        },
        spline: {
          marker: {
              enabled: false
          }
        },
        bar: {
          cursor: 'pointer',
                point: {
                    events: {
                        click: function () {
                            location.href = this.series.options.data[this.category][2] ;
                        }
                    }
                },
          dataLabels: {
            enabled: true,

            style: {
              textShadow: '0 0 0 black',
              color: '#333',
              fontFamily: 'Helvetica',
              fontWeight: 'normal'
            },
            formatter: function() {
                if (this.y != 0) {
                  return this.y;
                } else {
                  return null;
                }
            }
          }
        }
      },
      colors: (["#b6da6b", "#5499C7", "#da6bb6"]),

      series: [{
          type: 'bar',
          name: 'Routes',
          data: <%= raw @facility.walls.where("zone_id = ?", fz).order('name ASC').map {|f| [f.name, Route.current.where("wall_id = ? and zone_id = ?", f, fz).count, "https://www.climbconnect.com/admin/facilities/#{@facility.id}/routes?utf8=%E2%9C%93&filterrific%5Bsearch_query%5D=&filterrific%5Bwith_grade_id%5D=&filterrific%5Bwith_zone_id%5D=&filterrific%5Bwith_wall_id%5D=#{ f.id }&filterrific%5Bwith_setter_id%5D=&filterrific%5Bwith_status_id%5D=#{Date.current}&filterrific%5Bsorted_by%5D=created_at_desc&_=" ] } %>
      },{
          type: 'spline',
          name: 'Target',
          data: <%= raw @facility.walls.where("zone_id = ?", fz).order('name ASC').map {|f| [f.name, FacilityTarget.where("wall_id = ? AND grade_id IS NULL", f).sum(:value) ] } %>
      }
    ]
    });
  });
</script>
<div id="wall_dist-<%= fz.id %>" style="width:100%; height:100%; position:relative;"></div>
